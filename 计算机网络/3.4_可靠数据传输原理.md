**可靠数据传输协议**（reliable data transfer protocol）

TCP是在不可靠的（IP）端到端网络层上实现的可靠数据传输协议。

### 3.4.1 构造可靠数据传输协议

#### 1 经完全可靠信道的可靠数据传输： rdt1.0

#### 2 经具有比特差错信道的可靠数据传输 rdt2.0

**肯定确认**（positive acknowledgment）ACK

**否定确认**（negative acknowledgment）NAK

这些控制报文使得接收方可以让发送方知道哪些内容被正确接收，哪些内容接收有误并因此需要重复。在计算机网络环境中，基于这样重传机制的可靠数据传输协议称为**自动重传请求协议**（Automatic Repeat reQuest, ARQ）

ARQ协议中还需要另外三种协议功能来处理存在比特差错的情况：
（1）差错检测 （2）接收方反馈 （3）重传

**停等协议**（stop-and-wait）

#### 3 经具有比特差错的丢包信道的可靠数据传输 rdt3.0

### 3.4.2 流水线可靠数据传输协议

流水线技术对可靠数据传输协议带来如下影响：
1. 必须增加序号范围，因为每个输送中的分组（不计算重传的）必须有一个唯一的序号，而且也许有多个在输送中的未确认报文。
2. 协议的发送方和接收方两端也许不得不缓存多个分组。发送方最低限度应当能缓存那些已发送但没有确认的分组。如下面讨论的那样，接收方或许也需要缓存那些已正确接收的分组。
3. 所需序号范围和对缓存的要求取决于数据传输协议如何处理丢失、损坏及延时过大的分组。解决流水线的差错恢复有两种基本方法：回退N步和选择重传

### 3.4.3 回退N步（GBN）

GBN协议也常被称为**滑动窗口协议**（sliding-window protocol）

GBN发送方必须响应三种类型的事件

1. 上层的调用。
2. 收到一个ACK。**累积确认**（cumulative acknowledgment）
3. 超时事件。

### 3.4.4 选择重传

可靠数据传输机制及其用途的总结

1. 检验和：用于检测在一个传输分组中的比特错误
2. 定时器：用于超时/重传一个分组，可能因为该分组（或其ACK）在信道中丢失了。由于当一个分组延时但未丢失（过早超时），或当一个分组已被接收方收到但从接收方到发送方的ACK丢失时，可能产生超时事件，所以接收方可能会收到一个分组的多个冗余副本。
3. 序号：用于为从发送方流向接收方的数据分组按顺序编号。所接收分组的序号间的空隙可使接收方检测出丢失的分组。具有相同序号的分组可使接收方检测出一个分组的冗余副本。
4. 确认：接收方用于告诉发送方一个分组或一组分组已被正确地接受到了。确认报文通常携带着被确认分组或多个分组的序号。确认可以是逐个的或累积的，这取决于协议。
5. 否定确认：接收方用于告诉发送方某个分组未被正确地接收。否定确认报文通常携带着未被正确接收的分组的序号。
6. 窗口、流水线：发送方也许被限制仅发送那些序号落在一个指定范围内的分组。通过允许一次发送多个分组但未被确认，发送方的利用率可在停等操作模式的基础上得到增加。我们很快将会看到，窗口长度可根据接收方接收和缓存报文的能力、网络中的拥塞程度或两者情况来进行设置。
