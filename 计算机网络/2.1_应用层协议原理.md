### 2.1.1 网络应用程序体系结构

**应用程序体系结构**（application architecture）

1 **客户-服务器体系结构**（client-server architecture）

利用客户-服务端体系结构，客户相互之间不直接通信。   
服务器具有周知的、固定的地址，该地址称为IP地址。因为该服务器总是打开的，客户总是能够通过向该服务器的IP地址发送分组来与其联系。

具有客户-服务器体系结构的非常著名的应用程序包括Web、FTP、Telnet（就是远程登陆）和电子邮件。

配备大量主机的**数据中心**（data center）常被用于创建强大的虚拟服务器（一个数据中心能够有数十万台服务器），用来为大量客户提供服务。


2 **P2P体系结构**（P2P architecture）

在一个P2P体系结构中，对位于数据中心的专用服务器有最小的（或者没有）依赖。相反，应用程序在间断连接的主机对之间使用直接通信，这些主机对被称为**对等方**。许多目前流行的、流量密集型应用都是P2P体系结构的。包括文件共享（如BitTorrent）、对等方协助下载加速器（如迅雷）、因特网电话和视频会议（如Skype）。

P2P体系存在一个特性叫做**自扩展性**（self-scalability）。例如，在一个P2P文件共享应用中，尽管每个对等方都由于请求文件产生工作负载，但每个对等方通过向其他对等方分发文件也为系统增加服务能力。

某些应用具有混合的体系结构，结合客户-服务器和P2P的元素。例如，对于许多即时讯息应用而言，服务器被用于跟踪用户的IP地址，但用户到用户的报文在用户主机之间（无需通过中间服务器）直接发送。


### 2.1.2 进程通信

用操作系统的术语来讲，进行通信的实际上是**进程**（process）而不是程序。一个进程可以被认为是运行在端系统上的一个程序。当多个进程运行在相同的端系统上时，它们使用进程间通信机制相互通信。

在两个不同端系统上的进程，通过跨越计算机网络交换报文而互信通信。发送进程生成并向网络中发送报文；接受进程接收这些报文并可能通过回传报文进行响应。

#### 1 客户（client）和服务器（server）进程

网络应用程序由成对的进程组成，这些进程通过网络互相发送报文。在一对进程之间的通信会话场景中，发起通信的进程被标识为客户，在会话开始时等待联系的进程是服务器。

#### 2 进程与计算机网络之间的接口

进程通过一个称为**套接字**（socket）的软件接口向网络发送报文和从网络接收报文。套接字是同一台主机内应用层与运输层之间的接口。由于该套接字是建立网络应用程序的可编程接口，因此，套接字也称为应用程序和网络之间的**应用程序编程接口**（Application Programming Interface， API）。应用程序开发者可以控制套接字在应用层端的一切，但是对该套接字的运输层端几乎没有控制权。

应用程序开发者对于运输层的控制权限仅限于（1）选择运输层协议；（2）也许能设置几个运输层参数，如最大缓存和最大报文段长度等。

#### 进程寻址

在一台主机上运行的进程为了向在另一台主机上运行的进程发送分组，需要接收进程有一个地址。为了标识该接收进程，需要定义两种信息：（1）主机的地址；（2）在目的主机中指定接收进程的标识符。

在因特网中，主机由其**IP地址**（IP address）标识。除了知道报文发送目的地的主机地址外，发送进程还必须指定运行在接收主机上的接收进程（更具体的说，是接受套接字），目的地**端口号**（port number）用于标识接受进程。

### 2.1.3 可供应用程序使用的运输服务

大体从四个方向对应用程序服务要求进行分类：可靠数据传输、吞吐量、定时和安全性。

#### 1 可靠数据传输（reliable data transfer）

确保由应用程序的一端发送的数据正确、完全地交付给该应用程序的另一端。

#### 2 吞吐量

**带宽敏感的应用**（bandwidth-sensitive application）：具有吞吐量要求，大多是一些多媒体应用。

弹性应用（elastic application）：能够根据当时可用的带宽或多或少地利用可供使用的吞吐量，例如电子邮件、文件传输以及web应用等。

#### 3 定时

运输层协议也能提供定时保证。如同具有吞吐量保证那样，定时保证能够以多种形式实现。例如：发送方注入进套接字中的每个比特到达接收方的套接字不迟于100ms。这种服务对交互式实时应用程序是十分重要的。如因特网电话、虚拟环境、电话会议和多方游戏等，这些服为了有效性而要求数据交付有严格的时间限制。

#### 4 安全性

运输协议能够为应用程序提供一种或多种安全性服务，例如加密解密、数据完整性和端点鉴别等。
（后文：无论TCP还是UDP都没有提供任何加密机制，所以由于隐私和安全问题，因特网业界已经研制了TCP的加强版，称为**安全套接字层**（Secure Sockets Layer， SSL）。用SSL加强后的TCP不仅能够做到传统的TCP所能做到的一切，而且提供了关键的进程到进程的安全性服务。包括加密、数据完整性和端点鉴别。SSL不是与TCP或UDP并列的第三种因特网传输协议，而是一种对TCP的加强，这种强化是在应用层实现的。）

### 2.1.4 因特网提供的运输服务

#### 1 TCP服务

TCP服务模型包括面向连接服务和可靠数据传输服务。当某个应用程序调用TCP作为其运输协议时，该应用程序就能获得来自TCP的这两种服务。

面向连接的服务：在应用层数据报文开始流动之前，TCP让客户和服务器相互交换运输层控制信息。这个所谓的握手过程提醒客户和服务器，让它们为大量分组的到来做好准备。在握手阶段后，一个**TCP连接**（TCP connection）就在两个进程的套接字之间建立了。这条连接是双全工的，即连接双方的进程可以在此连接上同时进行报文收发。当应用程序结束报文发送时，必须拆除该连接。

可靠的数据传输服务：通信进程能够依靠TCP，无差错、按适当顺序交付所有发送的数据。当应用程序的一端将字节流传进套接字时，他能够依靠TCP将相同的字节流交付给接收方的套接字，而没有字节的丢失和冗余。

TCP协议还具有拥塞控制机制，当发送方和接收方之间的网络出现拥塞时，TCP的拥塞控制机制会抑制发送进程（客户或服务器）。TCP拥塞控制也试图限制每个TCP连接，使它们达到公平共享网络带宽的目的。

#### 2 UDP服务

UDP是一种不提供不必要服务的轻量级运输协议，它仅提供最小服务。UDP是无连接的，因此在两个进程通信前没有握手过程。UDP协议提供一种不可靠数据传输服务，也就是说，当进程将一个报文发送进UDP套接字时，UDP协议并不能保证该报文到达接收进程，不仅如此，到达接收进程的报文也可能是乱序到达的。

UDP没有拥塞控制机制，所以UDP的发送端可以用它选定的任何速率向其下层（网络层）注入数据。

#### 3 因特网运输协议所不提供的服务

目前的因特网运输协议并未提供吞吐量和定时保证。

### 2.1.5 应用层协议（application-layer protocol）

应用层协议定义了运行在不同端系统上的应用程序进程如何相互传递报文。特别是应用层协议定义了：   
+ 交换的报文类型，例如请求报文和响应报文
+ 各种报文类型的语法，如报文中的各个字段及这些字段是如何描述的
+ 字段的语义，即这些字段中的信息的含义
+ 确定一个进程何时以及如何发送报文，对报文进行响应的规则

### 2.1.6 本书涉及的网络应用

本章详细讨论5种重要的应用：Web、文件传输、电子邮件、目录服务、流式视频和P2P。
